[![DOI](https://zenodo.org/badge/1012788432.svg)](https://doi.org/10.5281/zenodo.15815024)
# SARS-CoV-2 Genome Diversity Analysis Dataset

## Project Overview

This repository provides access to a curated dataset of SARS-CoV-2 genome sequences, designed to support scalable analysis of nucleotide diversity (π) and other population genetic studies. A data file, `all_clades_aligned.fas`, is generated by the `nucdiv_v4.py` bioinformatic pipeline, as detailed in the technical report: *"A Pipeline for Scalable Analysis of SARS-CoV-2 Nucleotide Diversity."* The primary data file is split into several compressed files as available at this repository. The files are assembled by concatenation to form the complete primary data file. One method for concatenating these files is shown below, but run this script in a directory that contains only the compressed file parts and verify there is sufficient disk space free):
```bash
gunzip -c *.fas.gz > all_clades_aligned_combined.fas
```
The pipeline processes data from the public UShER mutation-annotated phylogeny, employing a clade-based subsampling strategy to create a representative yet manageable whole-genome alignment. This dataset facilitates research into SARS-CoV-2 evolution, including the tracking of variant dynamics, the impact of selective sweeps, and the role of recombination.

## Data Description

The `data/` directory hosts the primary output of the `nucdiv_v4.py` bioinformatic pipeline, designed for scalable analysis of SARS-CoV-2 nucleotide diversity.

**Primary Data File:** `all_clades_aligned.fas` is stored in the following compressed file parts: all_clades_aligned_1.fas.gz, all_clades_aligned_2.fas.gz, all_clades_aligned_3.fas.gz, all_clades_aligned_4.fas.gz, all_clades_aligned_5.fas.gz.

*   **Format:** Multi-FASTA file containing concatenated consensus genome sequences of SARS-CoV-2.
*   **Content:** Each sequence represents a full-length consensus genome.
*   **FASTA Headers:** Sequence headers follow the format `>sample_id|CLADENAME`, where `sample_id` is the original strain identifier and `CLADENAME` is the sanitized Pangolin lineage name (e.g., `BA_2_75` for `BA.2.75`).
*   **Generation Process:**
    *   The sequences are derived from the UShER mutation-annotated phylogeny (specifically, the public release dated **2025-06-29**, using `public-2025-06-29.all.masked.pb`).
    *   The `nucdiv_v4.py` pipeline utilizes `matUtils` (v0.5.8+) to extract variant calls for subsampled genomes and `bcftools` (v1.18+) to generate consensus sequences against the SARS-CoV-2 reference genome (`NC_045512v2.fa`).
*   **Subsampling Strategy:**
    *   The dataset includes genomes from the top 250 most prevalent Pangolin lineages (at the time of data acquisition).
    *   For each of these major lineages, up to 1,000 genomes were randomly sampled (using a fixed random seed for reproducibility, `random_state=42`).
    *   Sample selection ensures that genomes are present in both the UShER tree and the accompanying metadata. Clade names like `Unassigned` are excluded. This exclusion reduced the number of clades in the data from 250 to 249.
*   **File Size and Access:**
    *   The original file `all_clades_aligned.fas` is approximately **7 GB**. However, the compressed file parts are **~75 MB**.
    *   The compression and file parts are the method of storage so that they are not dependent on the service **Git LFS (Large File Storage)**.
*   **Verification:** As per the pipeline's protocol, sequences in `all_clades_aligned.fas` have been verified for expected naming conventions, sequence lengths, and terminal regions. Samples not meeting these criteria were omitted from this final dataset and logged separately for inspection.

This dataset is intended for downstream population genetic analyses, including the calculation of nucleotide diversity (π), phylogenetic reconstruction, phylodynamic modeling, and ancestral state reconstruction.

## Accessing the Data

The main dataset is located at:

*   `data/`

**Analytical Utility:**

This whole-genome alignment is ready for various downstream bioinformatics applications, including:

*   Calculation of nucleotide diversity (π) across different genomic regions, time points, or clades.
*   Phylogenetic tree reconstruction using tools like IQ-TREE, RAxML, or MrBayes.
*   Advanced phylodynamic analyses with software like BEAST to infer effective population sizes, migration rates, and other evolutionary parameters.
*   Ancestral state reconstruction to identify key mutations leading to specific lineages.

## Technical Report

A comprehensive technical report detailing the data generation pipeline, theoretical background, and analytical methods is available in this repository:

*   [**Technical Report: A Pipeline for Scalable Analysis of SARS-CoV-2 Nucleotide Diversity**](./technical_report.md)

This report provides:
*   An in-depth explanation of the `nucdiv_v4.py` script used for generating the consensus sequences from the UShER tree.
*   Details on the `nucdiv_stats.py` script used for calculating nucleotide diversity (π) from the aligned sequences.
*   The theoretical underpinnings of nucleotide diversity, its interpretation in the context of SARS-CoV-2 evolution (including concepts like selective sweeps, mosaic evolution, and founder effects).
*   Software dependencies, expected output formats, and runtime considerations.
*   A discussion of the data hosting strategy and limitations of the dataset.

Researchers are strongly encouraged to consult this report to fully understand the dataset's provenance and the methodologies employed.

Note on Data Processing: The nucleotide diversity (π) values in the raw results file were generated with a preliminary version of the analysis script. A latent bug in this version could cause an artificial inflation of π in the presence of sequences with a high number of ambiguous bases ('N'). The primary visualization (heatmap) was generated **after** applying a strict quality filter (`pi < 0.001`), which removed all data points affected by this bug. All current and future analyses use a new, fully validated function that is robust to this issue (to be uploaded soon).

## Citation

If using this dataset or the methodology described in the technical report in your research, please cite:

*   Friedman, R. 2025. *Technical Report: A Pipeline for Scalable Analysis of SARS-CoV-2 Nucleotide Diversity*. GitHub Repository. [https://github.com/bob-friedman/data-sarscov2-genomes](https://github.com/bob-friedman/data-sarscov2-genomes). [(doi: 10.5281/zenodo.15815025)](https://doi.org/10.5281/zenodo.15815025)
*   Please also refer to `technical_report.md` for full details.

Consider also citing the original data sources and tools if relevant to your specific analysis, such as:
*   The UShER platform and its publications.
*   `matUtils` and `bcftools` if their specific functionalities are central to your work derived from this dataset.

## Acknowledgements

The conceptual development and drafting of the technical report, which details the methodology behind generating this dataset, benefited significantly from discussions and iterative refinement with an AI language model, Gemini 2.5 Pro, (Google, 6/5/2025). The process included the generation of hypotheses, development of Python code and documentation for implementation of the methodology, experimental design, drafting of the report, strategies for hosting and efficient handling of large data files, and interpretation of the data analysis and its presentation. The author oversaw and reviewed the accuracy and robustness of all parts of the study.
